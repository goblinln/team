!function(){var s={data:[],holidays:[],onclick:null},o={title:["负责人","任务内容","发布者","测试者"],months:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],weekdays:["日","一","二","三","四","五","六"],days:["工作日","周末","假日"],year:"年"};$.fn.gantt=function(){$(this).empty();var e=$.extend(!0,{},s,arguments[0]),t=$("<table>",{id:"gantt-view-table",class:"gantt text-center",border:"1"});$(this).append(t),new a(t,e).render(),new superTable("gantt-view-table",{cssSkin:"sDefault",fixedCols:4,headerRows:3})};var a=function(c,p){function n(e,t,s,a){t.append($("<td>",{class:"fw-2 fh",css:{overflow:"hidden"}}).text(s.name)),t.append($("<td>",{class:"fw-1 fh"}).text(s.creator)),t.append($("<td>",{class:"fw-1 fh"}).text(s.acceptor));for(var i=a.start;i.getTime()<=a.end.getTime();){var d=$("<td>",{class:"grid"}),n=y.dayType(i,p.holidays);n.type!=f.Workday&&(d.css("background-color","rgba(140,136,136,0.25)"),d.attr("title",n.desc)),t.append(d),i=y.addDays(i,1)}e.append(t)}return{render:function(){!function(){for(var e=0;e<p.data.length;++e)for(var t=0;t<p.data[e].tasks.length;++t)p.data[e].tasks[t].start=new Date(p.data[e].tasks[t].start),p.data[e].tasks[t].end=new Date(p.data[e].tasks[t].end);for(var e=0;e<p.holidays.length;++e)p.holidays[e].start=new Date(p.holidays[e].start),p.holidays[e].end=new Date(p.holidays[e].end)}();var e=Math.floor((c.parent().width()-440)/40-1),t=y.getBoundary(p.data,e,p.localized);!function(e){var t=$("<thead>",{}),s=$("<tr>",{});s.append($("<th>",{class:"fw-1",rowspan:3}).text(o.title[0])),s.append($("<th>",{class:"fw-2",rowspan:3}).text(o.title[1])),s.append($("<th>",{class:"fw-1",rowspan:3}).text(o.title[2])),s.append($("<th>",{class:"fw-1",rowspan:3}).text(o.title[3]));for(var a=0;a<e.months.length;++a)s.append($("<th>",{class:"fh",colspan:e.months[a].days}).text(e.months[a].name));for(var i=$("<tr>",{}),d=$("<tr>",{}),n=e.start;n.getTime()<=e.end.getTime();){var r=$("<th>",{class:"fw fh"}).text(o.weekdays[n.getDay()]),h=$("<th>",{class:"fw fh"}).text(n.getDate()),l=y.dayType(n,p.holidays);l.type!=f.Workday&&(r.css("color","goldenrod"),h.css("color","goldenrod"),r.attr("title",l.desc),h.attr("title",l.desc)),i.append(r),d.append(h),n=y.addDays(n,1)}t.append(s),t.append(i),t.append(d),c.append(t)}(t),function(e){for(var t=$("<tbody>",{}),s=0;s<p.data.length;++s){var a=p.data[s];if(!(a.tasks.length<=0)){var i=$("<tr>",{});i.append($("<td>",{rowspan:a.tasks.length}).text(a.owner)),n(t,i,a.tasks[0],e);for(var d=1;d<a.tasks.length;++d)i=$("<tr>",{}),n(t,i,a.tasks[d],e)}}c.append(t)}(t),function(e){for(var t=$("tbody>tr",c),s=0,a=0;a<p.data.length;++a)for(var i=p.data[a],d=0;d<i.tasks.length;++d){var n=$(t[s]).find("td.grid"),r=i.tasks[d],h=y.daysBetween(r.start,r.end,p.holidays),l=y.daysBetween(e.start,r.start,p.holidays),o=$("<div>",{class:"task-block px-2",title:r.name+": "+h.normalDays+"天/"+h.workDays+"工作日",css:{width:40*h.normalDays-8+"px","background-color":r.color}});o.data("gantt-task",r),r.icon&&0<r.icon.length?o.append('<i class="'+r.icon+'"></i> '+h.normalDays+" 天"):o.append(h.normalDays+" 天"),$(n[l.normalDays-1]).append(o),s++}}(t),$("div.task-block",c).on("click",function(){p.onclick&&p.onclick($(this).data("gantt-task"))})}}},f={Workday:0,Weekend:1,Holiday:2},y={addDays:function(e,t){return new Date(e.getTime()+864e5*t)},daysBetween:function(e,t,s){for(var a=Math.ceil((t.getTime()-e.getTime())/864e5)+1,i=0,d=e;d.getTime()<=t.getTime();)this.dayType(d,s).type==f.Workday&&i++,d=this.addDays(d,1);return{normalDays:a,workDays:i}},dayType:function(e,t){if(0==e.getDay())return{type:f.Weekend,desc:o.days[1]};for(var s=e.getTime(),a=0;a<t.length;++a){var i=t[a];if(s>=i.start&&s<=i.end)return{type:f.Holiday,desc:i.desc||o.days[2]}}return{type:f.Workday,desc:o.days[0]}},getBoundary:function(e,t){for(var s=(new Date).getTime(),a=s-12*t*3600*1e3,i=0;i<e.length;++i)for(var d=0;d<e[i].tasks.length;++d){var n=e[i].tasks[d];n.start&&n.end&&(a>n.start.getTime()&&(a=n.start.getTime()),s<n.end.getTime()&&(s=n.end.getTime()))}s-a<24*t*3600*1e3&&(s=a+24*t*3600*1e3);for(var r={start:new Date(a),end:new Date(s),months:[]},h=r.start,l={id:-1,days:0};h.getTime()<=s;)l.id!=h.getMonth()&&(-1!=l.id&&r.months.push({id:l.id,days:l.days,name:l.name}),l.id=h.getMonth(),l.days=0,l.name=h.getFullYear()+o.year+o.months[l.id]),h=this.addDays(h,1),l.days++;return-1!=l.id&&r.months.push({id:l.id,days:l.days,name:l.name}),r}}}();var superTable=function(e,t){var s,a,i,d,n,r,h,l;for(t=t||{},this.cssSkin=t.cssSkin||"",this.headerRows=parseInt(t.headerRows||"1"),this.fixedCols=parseInt(t.fixedCols||"0"),this.colWidths=t.colWidths||[],this.initFunc=t.onStart||null,this.callbackFunc=t.onFinish||null,this.initFunc&&this.initFunc(),this.sBase=document.createElement("DIV"),this.sFHeader=this.sBase.cloneNode(!1),this.sHeader=this.sBase.cloneNode(!1),this.sHeaderInner=this.sBase.cloneNode(!1),this.sFData=this.sBase.cloneNode(!1),this.sFDataInner=this.sBase.cloneNode(!1),this.sData=this.sBase.cloneNode(!1),this.sColGroup=document.createElement("COLGROUP"),this.sDataTable=document.getElementById(e),this.sDataTable.style.margin="0px",""!==this.cssSkin&&(this.sDataTable.className+=" "+this.cssSkin),0<this.sDataTable.getElementsByTagName("COLGROUP").length&&this.sDataTable.removeChild(this.sDataTable.getElementsByTagName("COLGROUP")[0]),this.sParent=this.sDataTable.parentNode,this.sParentHeight=this.sParent.offsetHeight,this.sParentWidth=this.sParent.offsetWidth,this.sBase.className="sBase",this.sFHeader.className="sFHeader",this.sHeader.className="sHeader",this.sHeaderInner.className="sHeaderInner",this.sFData.className="sFData",this.sFDataInner.className="sFDataInner",this.sData.className="sData",this.sHeaderTable=this.sDataTable.cloneNode(!1),this.sDataTable.tHead?(s=this.sDataTable.tHead,this.sHeaderTable.appendChild(s.cloneNode(!1)),a=this.sHeaderTable.tHead):(s=this.sDataTable.tBodies[0],this.sHeaderTable.appendChild(s.cloneNode(!1)),a=this.sHeaderTable.tBodies[0]),s=s.rows,n=0;n<this.headerRows;n++)a.appendChild(s[n].cloneNode(!0));for(this.sHeaderInner.appendChild(this.sHeaderTable),0<this.fixedCols&&(this.sFHeaderTable=this.sHeaderTable.cloneNode(!0),this.sFHeader.appendChild(this.sFHeaderTable),this.sFDataTable=this.sDataTable.cloneNode(!0),this.sFDataInner.appendChild(this.sFDataTable)),n=0,r=(s=this.sDataTable.tBodies[0].rows).length;n<r;n++){for(i=!0,h=0,l=s[n].cells.length;h<l;h++)if(1!==s[n].cells[h].colSpan||1!==s[n].cells[h].rowSpan){n+=s[n].cells[h].rowSpan-1,i=!1;break}if(!0===i)break}d=!0===i?n:0;try{for(n=0,r=s[d].cells.length;n<r;n++)n!==this.colWidths.length&&-1!==this.colWidths[n]||(this.colWidths[n]=s[d].cells[n].offsetWidth)}catch(e){}for(n=0,r=this.colWidths.length;n<r;n++)this.sColGroup.appendChild(document.createElement("COL")),this.sColGroup.lastChild.setAttribute("width",this.colWidths[n]);this.sDataTable.insertBefore(this.sColGroup.cloneNode(!0),this.sDataTable.firstChild),this.sHeaderTable.insertBefore(this.sColGroup.cloneNode(!0),this.sHeaderTable.firstChild),0<this.fixedCols&&(this.sFDataTable.insertBefore(this.sColGroup.cloneNode(!0),this.sFDataTable.firstChild),this.sFHeaderTable.insertBefore(this.sColGroup.cloneNode(!0),this.sFHeaderTable.firstChild)),""!==this.cssSkin&&(this.sDataTable.className+=" "+this.cssSkin+"-Main",this.sHeaderTable.className+=" "+this.cssSkin+"-Headers",0<this.fixedCols&&(this.sFDataTable.className+=" "+this.cssSkin+"-Fixed",this.sFHeaderTable.className+=" "+this.cssSkin+"-FixedHeaders")),0<this.fixedCols&&this.sBase.appendChild(this.sFHeader),this.sHeader.appendChild(this.sHeaderInner),this.sBase.appendChild(this.sHeader),0<this.fixedCols&&(this.sFData.appendChild(this.sFDataInner),this.sBase.appendChild(this.sFData)),this.sBase.appendChild(this.sData),this.sParent.insertBefore(this.sBase,this.sDataTable),this.sData.appendChild(this.sDataTable);var o,c,p="";try{this.sHeaderHeight=this.sDataTable.tBodies[0].rows[this.sDataTable.tHead?0:this.headerRows].offsetTop,p+="max-height: calc(100% - "+this.sHeaderHeight+"px);"}catch(e){var f=$(this.sParent);f.removeClass("fakeContainer"),f.find("div").removeClass(),f.find("div div:nth-child(1)").remove(),f.find("div div:nth-child(2)").remove(),f.find("div div:nth-child(3)").remove(),f.find("div div:nth-child(4)").remove()}o="margin-top: "+-1*this.sHeaderHeight+"px;",p+="margin-top: "+this.sHeaderHeight+"px;",0<this.fixedCols&&this.sDataTable.tBodies[0].rows[d]?(this.sFHeaderWidth=this.sDataTable.tBodies[0].rows[d].cells[this.fixedCols].offsetLeft,window.getComputedStyle&&(s=document.defaultView,a=this.sDataTable.tBodies[0].rows[0].cells[0],navigator.taintEnabled?this.sFHeaderWidth+=Math.ceil(parseInt(s.getComputedStyle(a,null).getPropertyValue("border-right-width"))/2):this.sFHeaderWidth+=parseInt(s.getComputedStyle(a,null).getPropertyValue("border-right-width"))),window.opera&&(this.sFData.style.height=this.sParentHeight+"px"),this.sFHeader.style.width=this.sFHeaderWidth+"px",o+="margin-left: "+-1*this.sFHeaderWidth+"px;",p+="margin-left: "+this.sFHeaderWidth+"px;",p+="width: calc(100% - "+this.sFHeaderWidth+"px);"):p+="width: 100%;",this.sData.style.cssText=p,this.sDataTable.style.cssText=o,0<(c=this).fixedCols?c.sData.onscroll=function(){c.sHeaderInner.style.right=c.sData.scrollLeft+"px",c.sFDataInner.style.top=-1*c.sData.scrollTop+"px"}:c.sData.onscroll=function(){c.sHeaderInner.style.right=c.sData.scrollLeft+"px"},this.callbackFunc&&this.callbackFunc()};